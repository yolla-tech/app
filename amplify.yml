version: 1

applications:
  - appRoot: .
    backend:
      phases:
        preBuild:
          commands:
            # Show docker-compose version
            - docker-compose version
            # Build both backend & frontend images from docker-compose
            - docker-compose build
        build:
          commands:
            # (Optional) Run tests against the backend container if desired
            # e.g. docker-compose run --rm backend pytest --maxfail=1 --disable-warnings

            # Install dependencies & build the frontend
            - docker-compose run --rm frontend npm install
            - docker-compose run --rm frontend npm run build
    frontend:
      phases:
        preBuild:
          commands: []
        build:
          commands: []
      artifacts:
        # This is where Amplify will look for the static files to deploy
        baseDirectory: frontend/build
        files:
          - '**/*'
      cache:
        paths:
          - frontend/node_modules/**/*
